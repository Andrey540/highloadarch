# Отчёт по домашнему заданию №10

## Описание

Для подсчёта количства непрочитанных сообщений реализован микросервис counter.
Данный сервис отвечает за хранение количества непрочитанных сообщений.
Сами непрочитанные сообщения хранятся в микросервисе conversation.
Микросервис conversation при добавлении нового сообщения генерирует событие UnreadMessageAdded.
Это событие обрабатывает микросервис counter и инкрементирует счётчик.
Когда пользователь заходит на страницу сообщений посылается запрос на то, чтобы пометить сообщения прочитанными.
По каждому сообщению микросервис conversation хранит информацию прочитано ли оно данным пользователем.
Для того, чтобы реализовать полноценный механизм пометки непрочитанных сообщений нужно реализовать умный frontend.
Поэтому а данном задании эмулирована работа frontend - при заходе пользователя в переписку, микросервис socialnetwork
посылает запрос в микросервис conversation, чтобы тот пометил все полученные сообщения прочитанными.
Когда микросервис conversation помечает сообщения прочитанными, он генерирует событие MessagesRead, в котром по даннму пользователю
содержатся его прочитанные сообщения.
Микросервис counter получает это сообщение и уменьшает счётчик непрочитанных сообщений.
Так же для того, чтобы микросервис counter быстро отдавал данные, можно использовать кеш в виде redis-а и инвалидировать кеш при получении событий.
В микросервисе counter на кождого пользователя, на каждую беседу хранится отдельный счётчик.

Для того, чтобы посмотреть все беседы пользователя, можно зайти на страницу Conversations.
На данной странице у каждой беседы свой счётчик непрочитанных сообщений.
Для того, чтобы начать беседу нужно в списке пользователей добавить пользователя в друзья и начать беседу.

В качетсве БД микросервиса counter выступает отдельный keyspace vitess.
Для обеспечения согласованности данных во всех микросервисах используется паттерн transactional outbox и 
идемпатентная обработка событий.

Приложение запускается следующим образом.
Поднимаем контейнеры.
```bash
docker-compose up
```

И запустить репликацию.
```bash
./start_replication.sh
```